generator client { provider = "prisma-client-js" }

datasource db { provider = "postgresql"; url = env("DATABASE_URL") }

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  phone        String?
  passwordHash String
  role         Role     @default(COURIER)
  createdAt    DateTime @default(now())
  assignments  Assignment[]
}

model Order {
  id                String   @id @default(cuid())
  ozonPostingNumber String   @unique
  ozonOrderId       String?
  deliverySchema    String?
  sku               String?
  article           String?
  buyerAddressRaw   String
  lat               Float?
  lng               Float?
  deliveryDate      DateTime?
  phoneMasked       String?
  deliveryPriceRub  Int?
  status            OrderStatus @default(NEW)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  assignments       Assignment[]
}

model Assignment {
  id           String   @id @default(cuid())
  order        Order    @relation(fields: [orderId], references: [id])
  orderId      String
  courier      User     @relation(fields: [courierId], references: [id])
  courierId    String
  assignedBy   User     @relation("assignedBy", fields: [assignedById], references: [id])
  assignedById String
  note         String?
  assignedAt   DateTime @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  type      String
  payload   Json
  readAt    DateTime?
  createdAt DateTime @default(now())
}

enum Role { MANAGER COURIER }

enum OrderStatus { NEW ASSIGNED DELIVERED }
